show local variables like '%lock%';
                Variable_name                 |        Value         
----------------------------------------------+----------------------
 block_encryption_mode                        | aes-128-ecb
 group_replication_gtid_assignment_block_size | 1000000
 have_backup_locks                            | YES
 innodb_api_disable_rowlock                   | OFF
 innodb_autoinc_lock_mode                     | 2
 innodb_deadlock_detect                       | ON
 innodb_lock_wait_timeout                     | 20
 innodb_old_blocks_pct                        | 37
 innodb_old_blocks_time                       | 1000
 innodb_page_hash_locks                       | 16
 innodb_print_all_deadlocks                   | ON
 innodb_print_lock_wait_timeout_info          | OFF
 innodb_show_locks_held                       | 10
 innodb_sleep_wait4_free_block                | 30000
 innodb_status_output_locks                   | OFF
 innodb_table_locks                           | ON
 key_cache_block_size                         | 1024
 lock_order                                   | OFF
 lock_order_debug_loop                        | OFF
 lock_order_debug_missing_arc                 | OFF
 lock_order_debug_missing_key                 | OFF
 lock_order_debug_missing_unlock              | OFF
 lock_order_dependencies                      | 
 lock_order_extra_dependencies                | 
 lock_order_output_directory                  | 
 lock_order_print_txt                         | OFF
 lock_order_trace_loop                        | OFF
 lock_order_trace_missing_arc                 | ON
 lock_order_trace_missing_key                 | OFF
 lock_order_trace_missing_unlock              | ON
 lock_wait_timeout                            | 5
 locked_in_memory                             | OFF
 max_write_lock_count                         | 18446744073709551615
 performance_schema_max_metadata_locks        | -1
 performance_schema_max_rwlock_classes        | 70
 performance_schema_max_rwlock_instances      | -1
 performance_schema_max_table_lock_stat       | -1
 query_alloc_block_size                       | 16384
 range_alloc_block_size                       | 4096
 skip_external_locking                        | ON
 transaction_alloc_block_size                 | 8192
(41 rows)

-- strict: only show variables that can be modified&cached in computing node
show variables like '%lock%' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 20
 lock_wait_timeout        | 5
 query_alloc_block_size   | 16384
 range_alloc_block_size   | 4096
(4 rows)

show global variables like '%lock%';
                Variable_name                 |        Value         
----------------------------------------------+----------------------
 block_encryption_mode                        | aes-128-ecb
 group_replication_gtid_assignment_block_size | 1000000
 have_backup_locks                            | YES
 innodb_api_disable_rowlock                   | OFF
 innodb_autoinc_lock_mode                     | 2
 innodb_deadlock_detect                       | ON
 innodb_lock_wait_timeout                     | 20
 innodb_old_blocks_pct                        | 37
 innodb_old_blocks_time                       | 1000
 innodb_page_hash_locks                       | 16
 innodb_print_all_deadlocks                   | ON
 innodb_print_lock_wait_timeout_info          | OFF
 innodb_show_locks_held                       | 10
 innodb_sleep_wait4_free_block                | 30000
 innodb_status_output_locks                   | OFF
 innodb_table_locks                           | ON
 key_cache_block_size                         | 1024
 lock_order                                   | OFF
 lock_order_debug_loop                        | OFF
 lock_order_debug_missing_arc                 | OFF
 lock_order_debug_missing_key                 | OFF
 lock_order_debug_missing_unlock              | OFF
 lock_order_dependencies                      | 
 lock_order_extra_dependencies                | 
 lock_order_output_directory                  | 
 lock_order_print_txt                         | OFF
 lock_order_trace_loop                        | OFF
 lock_order_trace_missing_arc                 | ON
 lock_order_trace_missing_key                 | OFF
 lock_order_trace_missing_unlock              | ON
 lock_wait_timeout                            | 5
 locked_in_memory                             | OFF
 max_write_lock_count                         | 18446744073709551615
 performance_schema_max_metadata_locks        | -1
 performance_schema_max_rwlock_classes        | 70
 performance_schema_max_rwlock_instances      | -1
 performance_schema_max_table_lock_stat       | -1
 query_alloc_block_size                       | 16384
 range_alloc_block_size                       | 4096
 skip_external_locking                        | ON
 transaction_alloc_block_size                 | 8192
(41 rows)

show global variables like '%lock%' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 20
 lock_wait_timeout        | 5
 query_alloc_block_size   | 16384
 range_alloc_block_size   | 4096
(4 rows)

show lock_wait_timeout;
   Variable_name   | Value 
-------------------+-------
 lock_wait_timeout | 5
(1 row)

set global innodb_lock_wait_timeout = 4;
show global variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 4
(1 row)

show session variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 20
(1 row)

set session innodb_lock_wait_timeout = 3;
show session variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 3
(1 row)

show global variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 4
(1 row)

set innodb_lock_wait_timeout = 2;
show session variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 2
(1 row)

show global variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 4
(1 row)

set local innodb_lock_wait_timeout = 1;
WARNING:  SET LOCAL can only be used in transaction blocks
show session variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 1
(1 row)

show global variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 4
(1 row)

set persist innodb_lock_wait_timeout = 9;
show session variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 1
(1 row)

show global variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 9
(1 row)

set persist_only innodb_lock_wait_timeout = 11;
ERROR:  MySQL storage node (1, 3) returned error: 3630, Access denied; you need SYSTEM_VARIABLES_ADMIN and PERSIST_RO_VARIABLES_ADMIN privileges for this operation.
show session variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 1
(1 row)

show global variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 9
(1 row)

set shard global innodb_lock_wait_timeout = 4;
show global variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 4
(1 row)

show session variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 1
(1 row)

set shard session innodb_lock_wait_timeout = 3;
show session variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 3
(1 row)

show global variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 4
(1 row)

set shard local innodb_lock_wait_timeout = 1;
show session variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 1
(1 row)

show global variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 4
(1 row)

set shard persist innodb_lock_wait_timeout = 9;
show session variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 1
(1 row)

show global variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 9
(1 row)

set shard persist_only innodb_lock_wait_timeout = 11;
ERROR:  MySQL storage node (1, 3) returned error: 3630, Access denied; you need SYSTEM_VARIABLES_ADMIN and PERSIST_RO_VARIABLES_ADMIN privileges for this operation.
show session variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 1
(1 row)

show global variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 9
(1 row)

set innodb_lock_wait_timeout = 1;
set @@global.innodb_lock_wait_timeout = 4;
show global variables like 'innodb_lock_wait_timeout';
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 4
(1 row)

show session variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 1
(1 row)

set @@session.innodb_lock_wait_timeout = 3;
show variables like 'innodb_lock_wait_timeout';
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 3
(1 row)

show global variables like 'innodb_lock_wait_timeout';
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 4
(1 row)

set @@innodb_lock_wait_timeout = 2;
ERROR:  syntax error at or near "innodb_lock_wait_timeout"
LINE 1: set @@innodb_lock_wait_timeout = 2;
              ^
show session variables like 'innodb_lock_wait_timeout';
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 3
(1 row)

show global variables like 'innodb_lock_wait_timeout';
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 4
(1 row)

set @@local.innodb_lock_wait_timeout = 1;
show local variables like 'innodb_lock_wait_timeout';
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 1
(1 row)

show global variables like 'innodb_lock_wait_timeout';
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 4
(1 row)

set @@local.innodb_lock_wait_timeout = 5;
set @@persist.innodb_lock_wait_timeout = 9;
show local variables like 'innodb_lock_wait_timeout' strict;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 5
(1 row)

show global variables like 'innodb_lock_wait_timeout';
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 9
(1 row)

set @@persist_only.innodb_lock_wait_timeout = 11;
ERROR:  MySQL storage node (1, 3) returned error: 3630, Access denied; you need SYSTEM_VARIABLES_ADMIN and PERSIST_RO_VARIABLES_ADMIN privileges for this operation.
show innodb_lock_wait_timeout;
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 5
(1 row)

show global variables like 'innodb_lock_wait_timeout';
      Variable_name       | Value 
--------------------------+-------
 innodb_lock_wait_timeout | 9
(1 row)

show persist variables like 'innodb_lock_wait_timeout' strict;
ERROR:  In 'SHOW scope VARIABLES' stmt, scope can only be SESSION or GLOBAL
show persist_only variables like 'innodb_lock_wait_timeout' strict;
ERROR:  In 'SHOW scope VARIABLES' stmt, scope can only be SESSION or GLOBAL
create table tt(a int primary key, b int) partition by list(a);
create table tt1 partition of tt for values in (1);
create table tt2 partition of tt for values in (2);
create table tt3 partition of tt for values in (3);
create table tt4 partition of tt for values in (4);
insert into tt values(1,1),(2,2),(3,3),(4,4);
set session debug='+d,crash_before_flush_binlog';
-- connection breaks
update tt set b=b+1;
WARNING:  Connection with MySQL storage node (1, 3) is gone: 2013, Lost connection to MySQL server during query. Resend the statement.
DETAIL:  Disconnected all connections to MySQL storage nodes.
-- cached value (5) should be set
select*from tt;
ERROR:  Failed to connect to mysql storage node at (127.0.0.1, 3103): 2002, Can't connect to MySQL server on '127.0.0.1' (111)
select*from tt;
ERROR:  Failed to connect to mysql storage node at (127.0.0.1, 3103): 2002, Can't connect to MySQL server on '127.0.0.1' (111)
select*from tt;
ERROR:  Failed to connect to mysql storage node at (127.0.0.1, 3103): 2002, Can't connect to MySQL server on '127.0.0.1' (111)
show innodb_lock_wait_timeout;
ERROR:  Failed to connect to mysql storage node at (127.0.0.1, 3103): 2002, Can't connect to MySQL server on '127.0.0.1' (111)
show local variables like 'innodb_lock_wait_timeout';
ERROR:  Failed to connect to mysql storage node at (127.0.0.1, 3103): 2002, Can't connect to MySQL server on '127.0.0.1' (111)
show variables like 'debug';
ERROR:  Failed to connect to mysql storage node at (127.0.0.1, 3103): 2002, Can't connect to MySQL server on '127.0.0.1' (111)
show session variables like '%debug%';
ERROR:  Failed to connect to mysql storage node at (127.0.0.1, 3103): 2002, Can't connect to MySQL server on '127.0.0.1' (111)
show global variables like 'innodb_lock_wait_timeout' strict;
ERROR:  Failed to connect to mysql storage node at (127.0.0.1, 3103): 2002, Can't connect to MySQL server on '127.0.0.1' (111)
show variables;
ERROR:  Failed to connect to mysql storage node at (127.0.0.1, 3103): 2002, Can't connect to MySQL server on '127.0.0.1' (111)
show variables strict;
ERROR:  Failed to connect to mysql storage node at (127.0.0.1, 3103): 2002, Can't connect to MySQL server on '127.0.0.1' (111)
show global variables;
ERROR:  Failed to connect to mysql storage node at (127.0.0.1, 3103): 2002, Can't connect to MySQL server on '127.0.0.1' (111)
show global variables strict;
ERROR:  Failed to connect to mysql storage node at (127.0.0.1, 3103): 2002, Can't connect to MySQL server on '127.0.0.1' (111)
drop table tt;
ERROR:  Failed to connect to mysql storage node at (127.0.0.1, 3202): 2002, Can't connect to MySQL server on '127.0.0.1' (111)
